---
import BaseLayout from '../layouts/BaseLayout.astro';
import EmailSignup from '../components/EmailSignup.astro';
import energyData from '../data/energy-prices.json';
import { getEnergyPriceStats } from '../lib/energy-prices';

const { latest, ratio } = getEnergyPriceStats(energyData);
const euPrice = Math.round(latest.europe);
const usPrice = Math.round(latest.usa);
const ratioDisplay = `${ratio.toFixed(1)}×`;
const latestYear = latest.year;
---

<BaseLayout title="PowerEurope">
  <!-- Hero - Minimal, text-focused -->
  <section class="py-16 md:py-24 border-b border-ink-200">
    <div class="container-narrow">
      <p class="label mb-4">A citizen movement for energy sovereignty</p>
      <h1 class="mb-6">Europe Must Build Again</h1>
      <p class="text-xl text-ink-600 mb-8 max-w-xl">
        Cheap energy is the foundation of prosperity, security, and environmental protection. Europe is pricing itself out of the future.
      </p>
      <div class="flex gap-4">
        <a href="/research/energy-strategy" class="btn btn-primary">Read our analysis</a>
        <a href="/data" class="btn btn-secondary">See the data</a>
      </div>
    </div>
  </section>

  <!-- Key stat -->
  <section class="py-12 border-b border-ink-200">
    <div class="container-wide">
      <div class="grid md:grid-cols-3 gap-8">
        <div class="stat">
          <p class="stat-value">€{euPrice}</p>
          <p class="stat-label">EU industrial electricity price per MWh</p>
        </div>
        <div class="stat">
          <p class="stat-value">{`$${usPrice}`}</p>
          <p class="stat-label">US industrial electricity price per MWh</p>
        </div>
        <div class="stat">
          <p class="stat-value">{ratioDisplay}</p>
          <p class="stat-label">Europe's cost disadvantage</p>
        </div>
      </div>
      <p class="text-sm text-ink-500 mt-6">Source: Eurostat, EIA ({latestYear})</p>
    </div>
  </section>

  <!-- Chart -->
  <section class="section border-b border-ink-200">
    <div class="container-wide">
      <h2 class="text-display-sm mb-2">The Divergence</h2>
      <p class="text-ink-600 mb-8 max-w-xl">
        European industrial electricity prices have risen while competitors' prices remained stable. The gap is structural.
      </p>
      <div class="chart-container">
        <div id="price-chart" class="h-[350px]">
          <p class="text-ink-400 text-sm">Loading...</p>
        </div>
      </div>
      <p class="text-sm text-ink-500 mt-4">
        Industrial electricity prices, EUR/MWh. Source: Eurostat, EIA, IEA.
        <a href="/data/energy-prices" class="underline">Full data →</a>
      </p>
    </div>
  </section>

  <!-- The argument -->
  <section class="section border-b border-ink-200">
    <div class="container-narrow">
      <h2 class="text-display-sm mb-8">The Problem</h2>
      <div class="prose">
        <p>
          Europe has the most expensive industrial electricity in the developed world. This is not an accident—it is the result of policy choices: carbon pricing, renewable subsidies, nuclear phase-outs, and regulatory barriers.
        </p>
        <p>
          The consequences are visible. Energy-intensive industries are leaving. AI infrastructure is being built elsewhere. The gap between European and American productivity continues to widen.
        </p>
        <p>
          <strong>The claim that expensive energy is the price of environmental protection is false.</strong> Wealthy countries protect their environments; poor countries cannot. Europe is choosing a path toward poverty.
        </p>
      </div>
      <a href="/research/energy-strategy" class="inline-block mt-8 text-sm font-medium underline underline-offset-4">
        Read our full analysis →
      </a>
    </div>
  </section>

  <!-- The plan - minimal -->
  <section class="section border-b border-ink-200">
    <div class="container-narrow">
      <h2 class="text-display-sm mb-8">The Path Forward</h2>
      <div class="space-y-6">
        <div class="border-l-2 border-ink-950 pl-5">
          <p class="font-semibold">Immediate: Coal as bridge</p>
          <p class="text-ink-600 text-sm mt-1">
            Suspend carbon taxes. Reopen coal capacity. Buy time for nuclear construction.
          </p>
        </div>
        <div class="border-l-2 border-ink-300 pl-5">
          <p class="font-semibold">Medium-term: Nuclear buildout</p>
          <p class="text-ink-600 text-sm mt-1">
            License proven reactor designs. Deploy SMRs. Build domestic fuel cycle.
          </p>
        </div>
        <div class="border-l-2 border-ink-300 pl-5">
          <p class="font-semibold">Long-term: Energy parity</p>
          <p class="text-ink-600 text-sm mt-1">
            Achieve cost parity with US and China. Phase out coal as nuclear comes online.
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Image break -->
  <section class="relative h-[40vh] min-h-[300px]">
    <img
      src="/images/nuclear-cooling-towers.jpg"
      alt="Nuclear power plant"
      class="w-full h-full object-cover grayscale"
    />
  </section>

  <!-- Politics -->
  <section class="section border-b border-ink-200 bg-ink-950 text-white">
    <div class="container-narrow">
      <h2 class="text-display-sm mb-8 text-white">Not Left, Not Right</h2>
      <div class="prose text-ink-300">
        <p>
          Energy sovereignty is not a partisan issue. The right wants industrial capacity and defense capability. The left wants climate action and worker protection. Both require cheap, abundant energy.
        </p>
        <p class="text-white">
          We work with anyone who wants Europe to build again.
        </p>
      </div>
    </div>
  </section>

  <!-- Join -->
  <section class="section">
    <div class="container-narrow">
      <h2 class="text-display-sm mb-4">Stay Informed</h2>
      <p class="text-ink-600 mb-8">
        Receive our research and analysis. No spam.
      </p>
      <EmailSignup variant="compact" />
    </div>
  </section>
</BaseLayout>

<script>
  import * as Plot from '@observablehq/plot';
  import energyData from '../data/energy-prices.json';
  import { createResponsiveChart } from '../lib/charts';
  import { energyPriceColors, getEnergyPriceSeries } from '../lib/energy-prices';

  const data = getEnergyPriceSeries(energyData);
  const latestYear = energyData.timeSeries[energyData.timeSeries.length - 1].year;

  const container = document.getElementById('price-chart');
  if (container) {
    createResponsiveChart(container, (width) => Plot.plot({
      width,
      height: 320,
      marginLeft: 45,
      marginRight: 80,
      marginBottom: 30,
      marginTop: 10,
      style: {
        background: 'transparent',
        fontSize: '11px',
        fontFamily: 'Inter, system-ui, sans-serif',
      },
      x: {
        label: null,
        tickFormat: 'd',
      },
      y: {
        label: null,
        grid: true,
        domain: [0, 200],
        tickFormat: d => `€${d}`,
      },
      color: energyPriceColors,
      marks: [
        Plot.ruleY([0], { stroke: '#e3e3e3' }),
        Plot.line(data, {
          x: 'year',
          y: 'price',
          stroke: 'region',
          strokeWidth: d => d.region === 'Europe' ? 2.5 : 1.5,
        }),
        Plot.text(
          data.filter(d => d.year === latestYear),
          {
            x: 'year',
            y: 'price',
            text: 'region',
            dx: 6,
            textAnchor: 'start',
            fill: 'region',
            fontWeight: d => d.region === 'Europe' ? '600' : '400',
            fontSize: 11,
          }
        ),
      ],
    }));
  }
</script>
